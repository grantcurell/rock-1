version: '2'
services:
  elastic:
    image: "{{ elastic_container }}:{{ elastic_ver }}"
    restart: "always"
    ports:
      - "{{ elastic_data_port }}:{{ elastic_data_port }}"
      - "{{ elastic_management_port }}:{{ elastic_management_port }}"
    network_mode: host
    volumes:
      - "{{ es_data_dir }}:/usr/share/elasticsearch/data/"
      - "{{ es_config_dir}}/jvm.options:{{ es_config_dir }}/jvm.options"
    environment:
      - cluster.name={{ es_cluster_name }}
      - node.name={{ es_node_name }}
      - xpack.security.enabled=false
      #- processors=8
      - network.publish_host=_eth0_
      - http.host=0.0.0.0
      - transport.tcp.port={{ elastic_management_port }}

      # This option keeps JVM memory from being paged out to swap
      - bootstrap.memory_lock=true

      #- discovery.zen.ping.unicast.hosts=old1:9300,old2:9301

    ulimits:
      memlock:
        soft: -1
        hard: -1

    # This caps the amount of memory available to the container
    mem_limit: {{ es_mem * 2 }}g
