# site.yml is the overall playbook, but all it does is include the other playbooks that are part of the site. For more
# information about the structure see:
# http://docs.ansible.com/ansible/latest/playbooks_best_practices.html
# http://docs.ansible.com/ansible/latest/intro_inventory.html
# We follow the guidance to include naming conventions there.

---
- hosts: all

  tasks:

  # Useful for debugging, uncomment if you don't need it. This will post all
  # ansible related variables to the file /tmp/ansible.all
  #- name: Dump all vars
  #  action: template src=templates/dumpall.j2 dest=/tmp/ansible-site.all

  roles:
    - common

- hosts: docker
  roles:
    - docker

# kibana and portainer must come before haproxy as haproxy cannot run without
# being able to contact at least one of each backend servers (1 kibana, 1 portainer,
# 1 elasticsearch)
- hosts: kibana
  roles:
    - kibana

- hosts: portainer
  roles:
    - portainer

# haproxy must come before elasticsearch. The host running ansible will not
# beable to contact elasticsearch without haproxy running, this is required
# for elasticsearch's main tasks to complete. Adding haproxy to elasticsearch's
# dependencies is not an option due to ansible installing haproxy on every host
# that elasticsearch is assigned to.
- hosts: haproxy
  roles:
    - haproxy

- hosts: elasticsearch
  roles:
    - elasticsearch

- hosts: logstash
  roles:
    - logstash

- hosts: sensors
  roles:
    - sensor-common

- hosts: bro
  roles:
    - bro

- hosts: suricata
  roles:
    - suricata

- hosts: filebeat
  roles:
    - filebeat

- hosts: zookeeper
  roles:
    - zookeeper

- hosts: kafka
  roles:
    - kafka

# Harbor must run last so that it uploads all containers installed on the machine.
# Harbor has compose file issue, disabling for now
- hosts: harbor
  roles:
    - harbor
...
